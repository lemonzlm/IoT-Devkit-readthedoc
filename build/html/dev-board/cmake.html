

<!DOCTYPE html>


<html lang="zh-CN" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>:link:Cmake 速成 &#8212; IoT-Devkit 实验手册 0.2 文档</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../_static/translations.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'dev-board/cmake';</script>
    <link rel="author" title="关于这些文档" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="ESP-IDF SDK 基础" href="esp-idf.html" />
    <link rel="prev" title="Clion 项目工程基础" href="clion.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="zh-CN"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">IoT-Devkit 实验手册 0.2 文档</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">实验箱概述与理论准备</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="arch.html">实验系统构成</a></li>
<li class="toctree-l2"><a class="reference internal" href="ide.html">开发环境概览</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="mcu.html">MCU基础</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="esp32.html">ESP32</a></li>
<li class="toctree-l3"><a class="reference internal" href="stm32l475.html">STM32L475</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="clion.html">Clion 项目工程基础</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Cmake 构建系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="esp-idf.html">ESP-IDF SDK基础</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../exp-stm32/index.html">STM32实验篇</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../exp-stm32/ide-setup.html">IDE环境搭建</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exp-stm32/debug-flow.html">基本调试流程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exp-stm32/peripherals-and-sensors.html">外设与传感器</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exp-stm32/ble/index.html">BlueTooth</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exp-stm32/ble/ble-gatt.html"> GATT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-stm32/ble/ble-p2p.html"> BLE点对点(P2P)通信</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-stm32/ble/Profiles.html"> 蓝牙Profiles</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../exp-stm32/nfc.html">NFC</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exp-stm32/wifi/index.html">WiFi</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exp-stm32/wifi/tcp-over-wifi.html"> TCP over WiFi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-stm32/wifi/http-over-wifi.html"> HTTP over WiFi</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../exp-stm32/mqtt.html">MQTT</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../exp-esp32/index.html">ESP32实验篇</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exp-esp32/ide/index.html">IDE集成开发环境搭建</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/ide/esp-idf-setup.html"> ESP-IDF环境配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/ide/esp-idf-cli.html"> ESP-IDF命令行基本流程</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/ide/esp-idf-cli-debug.html"> ESP-IDF JTAG调试流程</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/ide/esp-idf-clion-dev.html"> Clion下ESP-IDF的配置与开发</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exp-esp32/peripherals/index.html">外设接口与传感器</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/peripherals/uart.html"> UART</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/peripherals/lcd%26spi.html"> LCD&amp;SPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/peripherals/i2c.html"> I2C</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/peripherals/camera.html"> 摄像头</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/peripherals/touch.html"> 触摸传感器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/peripherals/dht11.html"> 温湿度传感器采集</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/peripherals/light.html"> 光照传感器采集</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/peripherals/gesture.html"> 手势识别</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exp-esp32/bluetooth/index.html">BlueTooth</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/bluetooth/blufi.html"> BluFi配置实验</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/bluetooth/hci.html"> BlueTooth HCI主机控制接口</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/bluetooth/hid-gap.html"> 基于GAP的BlueTooth HID人机接口</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/bluetooth/hid-device-gatt.html"> 基于GATT的BLE HID设备</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exp-esp32/wifi/index.html">WiFi</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/wifi/station.html"> Station 模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/wifi/ap.html"> AP模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/wifi/esp-now.html"> ESP_NOW 协议</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/wifi/ftm.html"> WiFi测距FTM</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../exp-esp32/socket/index.html">Socket over WiFi</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/socket/tcp.html"> TCP Server and Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../exp-esp32/socket/udp.html"> UDP Server and Client</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../exp-esp32/websocket.html">WebSocket over WiFi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exp-esp32/http.html">HTTP over WiFi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exp-esp32/mqtt.html">MQTT over WiFi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exp-esp32/coap.html">CoAP over WiFi</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../exp-lora/index.html">LoRa实验篇</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../exp-lora/at-command.html">LoRa AT指令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exp-lora/p2p-stm32.html">LoRa P2P @STM32</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exp-lora/lorawan-stm32.html">LoRaWan @STM32</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exp-lora/mqtt-stm32.html">MQTT over LoRaWan @STM32</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exp-lora/p2p-esp32.html">LoRa P2P @ESP32</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exp-lora/lorawan-esp32.html">LoRaWan @ESP32</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exp-lora/mqtt-esp32.html">MQTT over LoRaWan @ESP32</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../exp-advanced/index.html">提高篇-Mesh与AIoT</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../exp-advanced/wifi-mesh.html">WiFi Mesh网</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exp-advanced/ble-mesh.html">BLE Mesh网</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exp-advanced/code-recognition.html">二维码识别</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exp-advanced/ai-face-detection.html">AI人脸识别</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exp-advanced/ai-motion-detection.html">AI运动检测</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exp-advanced/ai-tensor-flow-light.html">AI Tensor Flow Light</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">参考资料</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">关于我们</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="下载此页面">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/dev-board/cmake.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="下载源文件"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="列印成 PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="全屏模式"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="搜索" aria-label="搜索" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>:link:Cmake 速成</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> 目录 </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cmake">什么是 CMake?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">入门案例：单个源文件</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cmakelists-txt">编写 CMakeLists.txt</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">编译项目</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">多个源文件</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">同一目录，多个源文件</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">多个目录，多个源文件</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">自定义编译选项</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cmakelists">修改 CMakeLists 文件</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#http-main-cc">修改 http://main.cc 文件</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#http-config-h-in">编写 http://config.h.in 文件</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">编译项目</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-mymath-on">USE_MYMATH 为 ON</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-mymath-off">USE_MYMATH 为 OFF</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">安装和测试</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">定制安装规则</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">为工程添加测试</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gdb">支持 gdb</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">添加环境检查</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checkfunctionexists">添加 CheckFunctionExists 宏</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">预定义相关宏变量</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">在代码中使用宏和函数</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">添加版本号</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">生成安装包</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">项目迁移</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#autotools">autotools</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#qmake">qmake</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visual-studio">Visual Studio</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">CMakeLists.txt 自动推导</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="link-cmake">
<h1><a class="reference external" href="https://zhuanlan.zhihu.com/p/534439206">:link:</a>Cmake 速成<a class="headerlink" href="#link-cmake" title="Permalink to this heading">#</a></h1>
<blockquote>
<div><p>以下内容节选自网络文章。</p>
</div></blockquote>
<section id="cmake">
<h2>什么是 CMake?<a class="headerlink" href="#cmake" title="Permalink to this heading">#</a></h2>
<p>你或许听过好几种 Make 工具，例如 GNU Make ，QT 的 qmake ，微软的 MS nmake，BSD Make（pmake），Makepp，等等。这些 Make 工具遵循着不同的规范和标准，所执行的 Makefile 格式也千差万别。这样就带来了一个严峻的问题：如果软件想跨平台，必须要保证能够在不同平台编译。而如果使用上面的 Make 工具，就得为每一种标准写一次 Makefile ，这将是一件让人抓狂的工作。CMake 就是针对上面问题所设计的工具：它首先允许开发者编写一种平台无关的 CMakeList.txt 文件来定制整个编译流程，然后再根据目标用户的平台进一步生成所需的本地化 Makefile 和工程文件，如 Unix 的 Makefile 或 Windows 的 Visual Studio 工程。从而做到“Write once, run everywhere”。显然，CMake 是一个比上述几种 make 更高级的编译配置工具。一些使用 CMake 作为项目架构系统的知名开源项目有 VTK、ITK、KDE、OpenCV、OSG 等 [1]。在 linux 平台下使用 CMake 生成 Makefile 并编译的流程如下：</p>
<ol class="arabic simple">
<li><p>写 CMake 配置文件 CMakeLists.txt 。</p></li>
<li><p>执行命令 <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">PATH</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">ccmake</span> <span class="pre">PATH</span></code> 生成 Makefile（<code class="docutils literal notranslate"><span class="pre">ccmake</span></code> 和 <code class="docutils literal notranslate"><span class="pre">cmake</span></code> 的区别在于前者提供了一个交互式的界面）。其中， <code class="docutils literal notranslate"><span class="pre">PATH</span></code> 是 CMakeLists.txt 所在的目录。</p></li>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">make</span></code> 命令进行编译。</p></li>
</ol>
</section>
<section id="id1">
<h2>入门案例：单个源文件<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<p>本节对应的源代码所在目录：</p>
<blockquote>
<div><p><a class="reference external" href="https://link.zhihu.com/?target=https%3A//github.com/wzpan/cmake-demo/tree/master/Demo1">https://github.com/wzpan/cmake-demo/tree/master/Demo1</a></p>
</div></blockquote>
<p>对于简单的项目，只需要写几行代码就可以了。例如，假设现在我们的项目中只有一个源文件 main.cc ，该程序的用途是计算一个数的指数幂。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>

<span class="cm">/**</span>
<span class="cm"> * power - Calculate the power of number.</span>
<span class="cm"> * @param base: Base value.</span>
<span class="cm"> * @param exponent: Exponent value.</span>
<span class="cm"> *</span>
<span class="cm"> * @return base raised to the power exponent.</span>
<span class="cm"> */</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="nf">power</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">exponent</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">exponent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">exponent</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">base</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage: %s base exponent </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">exponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">power</span><span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">exponent</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%g ^ %d is %g</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">exponent</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<section id="cmakelists-txt">
<h3>编写 CMakeLists.txt<a class="headerlink" href="#cmakelists-txt" title="Permalink to this heading">#</a></h3>
<p>首先编写 CMakeLists.txt 文件，并保存在与 <a class="reference external" href="https://link.zhihu.com/?target=http%3A//main.cc">http://main.cc</a> 源文件同个目录下：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># CMake 最低版本号要求</span>
<span class="nb">cmake_minimum_required</span> <span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">2.8</span><span class="p">)</span>

<span class="c"># 项目信息</span>
<span class="nb">project</span> <span class="p">(</span><span class="s">Demo1</span><span class="p">)</span>

<span class="c"># 指定生成目标</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">Demo</span><span class="w"> </span><span class="s">main.cc</span><span class="p">)</span>
</pre></div>
</div>
<p>CMakeLists.txt 的语法比较简单，由命令、注释和空格组成，其中命令是不区分大小写的。符号 <code class="docutils literal notranslate"><span class="pre">#</span></code> 后面的内容被认为是注释。命令由命令名称、小括号和参数组成，参数之间使用空格进行间隔。对于上面的 CMakeLists.txt 文件，依次出现了几个命令：</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cmake_minimum_required</span></code>：指定运行此配置文件所需的 CMake 的最低版本；</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">project</span></code>：参数值是 <code class="docutils literal notranslate"><span class="pre">Demo1</span></code>，该命令表示项目的名称是 <code class="docutils literal notranslate"><span class="pre">Demo1</span></code> 。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">add_executable</span></code>：将名为 main.cc 的源文件编译成一个名称为 Demo 的可执行文件。</p></li>
</ol>
</section>
<section id="id2">
<h3>编译项目<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<p>之后，在当前目录执行 <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">.</span></code> ，得到 Makefile 后再使用 <code class="docutils literal notranslate"><span class="pre">make</span></code> 命令编译得到 Demo1 可执行文件。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>ehome@xman Demo1<span class="o">]</span>$ cmake .
-- The C compiler identification is GNU <span class="m">4</span>.8.2
-- The CXX compiler identification is GNU <span class="m">4</span>.8.2
-- Check <span class="k">for</span> working C compiler: /usr/sbin/cc
-- Check <span class="k">for</span> working C compiler: /usr/sbin/cc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - <span class="k">done</span>
-- Check <span class="k">for</span> working CXX compiler: /usr/sbin/c++
-- Check <span class="k">for</span> working CXX compiler: /usr/sbin/c++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - <span class="k">done</span>
-- Configuring <span class="k">done</span>
-- Generating <span class="k">done</span>
-- Build files have been written to: /home/ehome/Documents/programming/C/power/Demo1
<span class="o">[</span>ehome@xman Demo1<span class="o">]</span>$ make
Scanning dependencies of target Demo
<span class="o">[</span><span class="m">100</span>%<span class="o">]</span> Building C object CMakeFiles/Demo.dir/main.cc.o
Linking C executable Demo
<span class="o">[</span><span class="m">100</span>%<span class="o">]</span> Built target Demo
<span class="o">[</span>ehome@xman Demo1<span class="o">]</span>$ ./Demo <span class="m">5</span> <span class="m">4</span>
<span class="m">5</span> ^ <span class="m">4</span> is <span class="m">625</span>
<span class="o">[</span>ehome@xman Demo1<span class="o">]</span>$ ./Demo <span class="m">7</span> <span class="m">3</span>
<span class="m">7</span> ^ <span class="m">3</span> is <span class="m">343</span>
<span class="o">[</span>ehome@xman Demo1<span class="o">]</span>$ ./Demo <span class="m">2</span> <span class="m">10</span>
<span class="m">2</span> ^ <span class="m">10</span> is <span class="m">1024</span>
</pre></div>
</div>
</section>
</section>
<section id="id3">
<h2>多个源文件<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h2>
<section id="id4">
<h3>同一目录，多个源文件<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h3>
<p>本小节对应的源代码所在目录：</p>
<blockquote>
<div><p><a class="reference external" href="https://link.zhihu.com/?target=https%3A//github.com/wzpan/cmake-demo/tree/master/Demo2">https://github.com/wzpan/cmake-demo/tree/master/Demo2</a></p>
</div></blockquote>
<p>上面的例子只有单个源文件。现在假如把 <code class="docutils literal notranslate"><span class="pre">power</span></code> 函数单独写进一个名为 <code class="docutils literal notranslate"><span class="pre">MathFunctions.c</span></code> 的源文件里，使得这个工程变成如下的形式：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="o">/</span><span class="n">Demo2</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">+---</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cc</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">+---</span><span class="w"> </span><span class="n">MathFunctions</span><span class="p">.</span><span class="n">cc</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">+---</span><span class="w"> </span><span class="n">MathFunctions</span><span class="p">.</span><span class="n">h</span><span class="w"></span>
</pre></div>
</div>
<p>这个时候，CMakeLists.txt 可以改成如下的形式：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># CMake 最低版本号要求</span>
<span class="nb">cmake_minimum_required</span> <span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">2.8</span><span class="p">)</span>

<span class="c"># 项目信息</span>
<span class="nb">project</span> <span class="p">(</span><span class="s">Demo2</span><span class="p">)</span>

<span class="c"># 指定生成目标</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">Demo</span><span class="w"> </span><span class="s">main.cc</span><span class="w"> </span><span class="s">MathFunctions.cc</span><span class="p">)</span>
</pre></div>
</div>
<p>唯一的改动只是在 <code class="docutils literal notranslate"><span class="pre">add_executable</span></code> 命令中增加了一个 <code class="docutils literal notranslate"><span class="pre">MathFunctions.cc</span></code> 源文件。这样写当然没什么问题，但是如果源文件很多，把所有源文件的名字都加进去将是一件烦人的工作。更省事的方法是使用 <code class="docutils literal notranslate"><span class="pre">aux_source_directory</span></code> 命令，该命令会查找指定目录下的所有源文件，然后将结果存进指定变量名。其语法如下：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">aux_source_directory</span><span class="p">(</span><span class="o">&lt;</span><span class="n">dir</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">variable</span><span class="o">&gt;</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>因此，可以修改 CMakeLists.txt 如下：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp"># CMake 最低版本号要求</span>
<span class="n">cmake_minimum_required</span><span class="w"> </span><span class="p">(</span><span class="n">VERSION</span><span class="w"> </span><span class="mf">2.8</span><span class="p">)</span><span class="w"></span>

<span class="cp"># 项目信息</span>
<span class="n">project</span><span class="w"> </span><span class="p">(</span><span class="n">Demo2</span><span class="p">)</span><span class="w"></span>

<span class="cp"># 查找当前目录下的所有源文件</span>
<span class="cp"># 并将名称保存到 DIR_SRCS 变量</span>
<span class="n">aux_source_directory</span><span class="p">(.</span><span class="w"> </span><span class="n">DIR_SRCS</span><span class="p">)</span><span class="w"></span>

<span class="cp"># 指定生成目标</span>
<span class="n">add_executable</span><span class="p">(</span><span class="n">Demo</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">DIR_SRCS</span><span class="p">})</span><span class="w"></span>
</pre></div>
</div>
<p>这样，CMake 会将当前目录所有源文件的文件名赋值给变量 <code class="docutils literal notranslate"><span class="pre">DIR_SRCS</span></code> ，再指示变量 <code class="docutils literal notranslate"><span class="pre">DIR_SRCS</span></code> 中的源文件需要编译成一个名称为 Demo 的可执行文件。</p>
</section>
<section id="id5">
<h3>多个目录，多个源文件<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h3>
<p>本小节对应的源代码所在目录：</p>
<blockquote>
<div><p><a class="reference external" href="https://link.zhihu.com/?target=https%3A//github.com/wzpan/cmake-demo/tree/master/Demo3">https://github.com/wzpan/cmake-demo/tree/master/Demo3</a></p>
</div></blockquote>
<p>现在进一步将 MathFunctions.h 和 <a class="reference external" href="https://link.zhihu.com/?target=http%3A//MathFunctions.cc">http://MathFunctions.cc</a> 文件移动到 math 目录下。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="o">/</span><span class="n">Demo3</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">+---</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">cc</span><span class="w"></span>
<span class="w">    </span><span class="o">|</span><span class="w"></span>
<span class="w">    </span><span class="o">+---</span><span class="w"> </span><span class="n">math</span><span class="o">/</span><span class="w"></span>
<span class="w">          </span><span class="o">|</span><span class="w"></span>
<span class="w">          </span><span class="o">+---</span><span class="w"> </span><span class="n">MathFunctions</span><span class="p">.</span><span class="n">cc</span><span class="w"></span>
<span class="w">          </span><span class="o">|</span><span class="w"></span>
<span class="w">          </span><span class="o">+---</span><span class="w"> </span><span class="n">MathFunctions</span><span class="p">.</span><span class="n">h</span><span class="w"></span>
</pre></div>
</div>
<p>对于这种情况，需要分别在项目根目录 Demo3 和 math 目录里各编写一个 CMakeLists.txt 文件。为了方便，我们可以先将 math 目录里的文件编译成静态库再由 main 函数调用。根目录中的 CMakeLists.txt ：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># CMake 最低版本号要求</span>
<span class="nb">cmake_minimum_required</span> <span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">2.8</span><span class="p">)</span>

<span class="c"># 项目信息</span>
<span class="nb">project</span> <span class="p">(</span><span class="s">Demo3</span><span class="p">)</span>

<span class="c"># 查找当前目录下的所有源文件</span>
<span class="c"># 并将名称保存到 DIR_SRCS 变量</span>
<span class="nb">aux_source_directory</span><span class="p">(</span><span class="s">.</span><span class="w"> </span><span class="s">DIR_SRCS</span><span class="p">)</span>

<span class="c"># 添加 math 子目录</span>
<span class="nb">add_subdirectory</span><span class="p">(</span><span class="s">math</span><span class="p">)</span>

<span class="c"># 指定生成目标</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">Demo</span><span class="w"> </span><span class="s">main.cc</span><span class="p">)</span>

<span class="c"># 添加链接库</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">Demo</span><span class="w"> </span><span class="s">MathFunctions</span><span class="p">)</span>
</pre></div>
</div>
<p>该文件添加了下面的内容: 第 3 行，使用命令 <code class="docutils literal notranslate"><span class="pre">add_subdirectory</span></code> 指明本项目包含一个子目录 math，这样 math 目录下的 CMakeLists.txt 文件和源代码也会被处理 。第 6 行，使用命令 <code class="docutils literal notranslate"><span class="pre">target_link_libraries</span></code> 指明可执行文件 main 需要连接一个名为 MathFunctions 的链接库 。子目录中的 CMakeLists.txt：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># 查找当前目录下的所有源文件</span>
<span class="c"># 并将名称保存到 DIR_LIB_SRCS 变量</span>
<span class="nb">aux_source_directory</span><span class="p">(</span><span class="s">.</span><span class="w"> </span><span class="s">DIR_LIB_SRCS</span><span class="p">)</span>

<span class="c"># 生成链接库</span>
<span class="nb">add_library</span> <span class="p">(</span><span class="s">MathFunctions</span><span class="w"> </span><span class="o">${</span><span class="nv">DIR_LIB_SRCS</span><span class="o">}</span><span class="p">)</span>
</pre></div>
</div>
<p>在该文件中使用命令 <code class="docutils literal notranslate"><span class="pre">add_library</span></code> 将 src 目录中的源文件编译为静态链接库。</p>
</section>
</section>
<section id="id6">
<h2>自定义编译选项<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h2>
<p>本节对应的源代码所在目录：</p>
<blockquote>
<div><p><a class="reference external" href="https://link.zhihu.com/?target=https%3A//github.com/wzpan/cmake-demo/tree/master/Demo4">https://github.com/wzpan/cmake-demo/tree/master/Demo4</a></p>
</div></blockquote>
<p>CMake 允许为项目增加编译选项，从而可以根据用户的环境和需求选择最合适的编译方案。例如，可以将 MathFunctions 库设为一个可选的库，如果该选项为 <code class="docutils literal notranslate"><span class="pre">ON</span></code> ，就使用该库定义的数学函数来进行运算。否则就调用标准库中的数学函数库。</p>
<section id="cmakelists">
<h3>修改 CMakeLists 文件<a class="headerlink" href="#cmakelists" title="Permalink to this heading">#</a></h3>
<p>我们要做的第一步是在顶层的 CMakeLists.txt 文件中添加该选项：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># CMake 最低版本号要求</span>
<span class="nb">cmake_minimum_required</span> <span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">2.8</span><span class="p">)</span>

<span class="c"># 项目信息</span>
<span class="nb">project</span> <span class="p">(</span><span class="s">Demo4</span><span class="p">)</span>

<span class="c"># 加入一个配置头文件，用于处理 CMake 对源码的设置</span>
<span class="nb">configure_file</span> <span class="p">(</span>
<span class="w">  </span><span class="s2">&quot;${PROJECT_SOURCE_DIR}/config.h.in&quot;</span>
<span class="w">  </span><span class="s2">&quot;${PROJECT_BINARY_DIR}/config.h&quot;</span>
<span class="w">  </span><span class="p">)</span>

<span class="c"># 是否使用自己的 MathFunctions 库</span>
<span class="nb">option</span> <span class="p">(</span><span class="s">USE_MYMATH</span>
<span class="w">       </span><span class="s2">&quot;Use provided math implementation&quot;</span><span class="w"> </span><span class="s">ON</span><span class="p">)</span>

<span class="c"># 是否加入 MathFunctions 库</span>
<span class="nb">if</span> <span class="p">(</span><span class="s">USE_MYMATH</span><span class="p">)</span>
<span class="w">  </span><span class="nb">include_directories</span> <span class="p">(</span><span class="s2">&quot;${PROJECT_SOURCE_DIR}/math&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="nb">add_subdirectory</span> <span class="p">(</span><span class="s">math</span><span class="p">)</span>
<span class="w">  </span><span class="nb">set</span> <span class="p">(</span><span class="s">EXTRA_LIBS</span><span class="w"> </span><span class="o">${</span><span class="nv">EXTRA_LIBS</span><span class="o">}</span><span class="w"> </span><span class="s">MathFunctions</span><span class="p">)</span>
<span class="nb">endif</span> <span class="p">(</span><span class="s">USE_MYMATH</span><span class="p">)</span>

<span class="c"># 查找当前目录下的所有源文件</span>
<span class="c"># 并将名称保存到 DIR_SRCS 变量</span>
<span class="nb">aux_source_directory</span><span class="p">(</span><span class="s">.</span><span class="w"> </span><span class="s">DIR_SRCS</span><span class="p">)</span>

<span class="c"># 指定生成目标</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">Demo</span><span class="w"> </span><span class="o">${</span><span class="nv">DIR_SRCS</span><span class="o">}</span><span class="p">)</span>
<span class="nb">target_link_libraries</span> <span class="p">(</span><span class="s">Demo</span><span class="w">  </span><span class="o">${</span><span class="nv">EXTRA_LIBS</span><span class="o">}</span><span class="p">)</span>
</pre></div>
</div>
<p>其中：</p>
<ol class="arabic simple">
<li><p>第 7 行的 <code class="docutils literal notranslate"><span class="pre">configure_file</span></code> 命令用于加入一个配置头文件 config.h ，这个文件由 CMake 从 config.h.in 生成，通过这样的机制，将可以通过预定义一些参数和变量来控制代码的生成。</p></li>
<li><p>第 13 行的 <code class="docutils literal notranslate"><span class="pre">option</span></code> 命令添加了一个 <code class="docutils literal notranslate"><span class="pre">USE_MYMATH</span></code> 选项，并且默认值为 <code class="docutils literal notranslate"><span class="pre">ON</span></code> 。</p></li>
<li><p>第 17 行根据 <code class="docutils literal notranslate"><span class="pre">USE_MYMATH</span></code> 变量的值来决定是否使用我们自己编写的 MathFunctions 库。</p></li>
</ol>
</section>
<section id="http-main-cc">
<h3>修改 <a class="reference external" href="https://link.zhihu.com/?target=http%3A//main.cc">http://main.cc</a> 文件<a class="headerlink" href="#http-main-cc" title="Permalink to this heading">#</a></h3>
<p>之后修改 <a class="reference external" href="https://link.zhihu.com/?target=http%3A//main.cc">http://main.cc</a> 文件，让其根据 <code class="docutils literal notranslate"><span class="pre">USE_MYMATH</span></code> 的预定义值来决定是否调用标准库还是 MathFunctions 库：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;config.h&quot;</span><span class="cp"></span>

<span class="cp">#ifdef USE_MYMATH</span>
<span class="w">  </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;math/MathFunctions.h&quot;</span><span class="cp"></span>
<span class="cp">#else</span>
<span class="w">  </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>
<span class="cp">#endif</span>


<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage: %s base exponent </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">exponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span><span class="w"></span>

<span class="cp">#ifdef USE_MYMATH</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Now we use our own Math library. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">power</span><span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">exponent</span><span class="p">);</span><span class="w"></span>
<span class="cp">#else</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Now we use the standard library. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">exponent</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%g ^ %d is %g</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">exponent</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="http-config-h-in">
<h3>编写 <a class="reference external" href="https://link.zhihu.com/?target=http%3A//config.h.in">http://config.h.in</a> 文件<a class="headerlink" href="#http-config-h-in" title="Permalink to this heading">#</a></h3>
<p>上面的程序值得注意的是第 2 行，这里引用了一个 config.h 文件，这个文件预定义了 <code class="docutils literal notranslate"><span class="pre">USE_MYMATH</span></code> 的值。但我们并不直接编写这个文件，为了方便从 CMakeLists.txt 中导入配置，我们编写一个 config.h.in 文件，内容如下：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#cmakedefine USE_MYMATH</span>
</pre></div>
</div>
<p>这样 CMake 会自动根据 CMakeLists 配置文件中的设置自动生成 config.h 文件。</p>
</section>
<section id="id7">
<h3>编译项目<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h3>
<p>现在编译一下这个项目，为了便于交互式的选择该变量的值，可以使用 <code class="docutils literal notranslate"><span class="pre">ccmake</span></code> 命令（也可以使用 <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-i</span></code> 命令，该命令会提供一个会话式的交互式配置界面）：</p>
<p><img alt="img" src="https://pic2.zhimg.com/80/v2-d796be171c8fd08b017403f9df999455_1440w.webp" /></p>
<p>CMake 的交互式配置界面</p>
<p>CMake 的交互式配置界面从中可以找到刚刚定义的 <code class="docutils literal notranslate"><span class="pre">USE_MYMATH</span></code> 选项，按键盘的方向键可以在不同的选项窗口间跳转，按下 <code class="docutils literal notranslate"><span class="pre">enter</span></code> 键可以修改该选项。修改完成后可以按下 <code class="docutils literal notranslate"><span class="pre">c</span></code> 选项完成配置，之后再按 <code class="docutils literal notranslate"><span class="pre">g</span></code> 键确认生成 Makefile 。ccmake 的其他操作可以参考窗口下方给出的指令提示。我们可以试试分别将 <code class="docutils literal notranslate"><span class="pre">USE_MYMATH</span></code> 设为 <code class="docutils literal notranslate"><span class="pre">ON</span></code> 和 <code class="docutils literal notranslate"><span class="pre">OFF</span></code> 得到的结果：</p>
</section>
<section id="use-mymath-on">
<h3>USE_MYMATH 为 ON<a class="headerlink" href="#use-mymath-on" title="Permalink to this heading">#</a></h3>
<p>运行结果：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>ehome@xman Demo4<span class="o">]</span>$ ./Demo
Now we use our own MathFunctions library.
 <span class="m">7</span> ^ <span class="nv">3</span> <span class="o">=</span> <span class="m">343</span>.000000
 <span class="m">10</span> ^ <span class="nv">5</span> <span class="o">=</span> <span class="m">100000</span>.000000
 <span class="m">2</span> ^ <span class="nv">10</span> <span class="o">=</span> <span class="m">1024</span>.000000
</pre></div>
</div>
<p>此时 config.h 的内容为：</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#define USE_MYMATH</span>
</pre></div>
</div>
</section>
<section id="use-mymath-off">
<h3>USE_MYMATH 为 OFF<a class="headerlink" href="#use-mymath-off" title="Permalink to this heading">#</a></h3>
<p>运行结果：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>ehome@xman Demo4<span class="o">]</span>$ ./Demo
Now we use the standard library.
 <span class="m">7</span> ^ <span class="nv">3</span> <span class="o">=</span> <span class="m">343</span>.000000
 <span class="m">10</span> ^ <span class="nv">5</span> <span class="o">=</span> <span class="m">100000</span>.000000
 <span class="m">2</span> ^ <span class="nv">10</span> <span class="o">=</span> <span class="m">1024</span>.000000
</pre></div>
</div>
<p>此时 config.h 的内容为：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* #undef USE_MYMATH */</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="id8">
<h2>安装和测试<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h2>
<p>本节对应的源代码所在目录：</p>
<blockquote>
<div><p><a class="reference external" href="https://link.zhihu.com/?target=https%3A//github.com/wzpan/cmake-demo/tree/master/Demo5">https://github.com/wzpan/cmake-demo/tree/master/Demo5</a></p>
</div></blockquote>
<p>CMake 也可以指定安装规则，以及添加测试。这两个功能分别可以通过在产生 Makefile 后使用 <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code> 和 <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> 来执行。在以前的 GNU Makefile 里，你可能需要为此编写 <code class="docutils literal notranslate"><span class="pre">install</span></code> 和 <code class="docutils literal notranslate"><span class="pre">test</span></code> 两个伪目标和相应的规则，但在 CMake 里，这样的工作同样只需要简单的调用几条命令。</p>
<section id="id9">
<h3>定制安装规则<a class="headerlink" href="#id9" title="Permalink to this heading">#</a></h3>
<p>首先先在 math/CMakeLists.txt 文件里添加下面两行：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># 指定 MathFunctions 库的安装路径</span>
<span class="nb">install</span> <span class="p">(</span><span class="s">TARGETS</span><span class="w"> </span><span class="s">MathFunctions</span><span class="w"> </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">bin</span><span class="p">)</span>
<span class="nb">install</span> <span class="p">(</span><span class="s">FILES</span><span class="w"> </span><span class="s">MathFunctions.h</span><span class="w"> </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">include</span><span class="p">)</span>
</pre></div>
</div>
<p>指明 MathFunctions 库的安装路径。之后同样修改根目录的 CMakeLists 文件，在末尾添加下面几行：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># 指定安装路径</span>
<span class="nb">install</span> <span class="p">(</span><span class="s">TARGETS</span><span class="w"> </span><span class="s">Demo</span><span class="w"> </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">bin</span><span class="p">)</span>
<span class="nb">install</span> <span class="p">(</span><span class="s">FILES</span><span class="w"> </span><span class="s2">&quot;${PROJECT_BINARY_DIR}/config.h&quot;</span>
<span class="w">         </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">include</span><span class="p">)</span>
</pre></div>
</div>
<p>通过上面的定制，生成的 Demo 文件和 MathFunctions 函数库 libMathFunctions.o 文件将会被复制到 <code class="docutils literal notranslate"><span class="pre">/usr/local/bin</span></code> 中，而 MathFunctions.h 和生成的 config.h 文件则会被复制到 <code class="docutils literal notranslate"><span class="pre">/usr/local/include</span></code> 中。我们可以验证一下（顺带一提的是，这里的 <code class="docutils literal notranslate"><span class="pre">/usr/local/</span></code> 是默认安装到的根目录，可以通过修改 <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code> 变量的值来指定这些文件应该拷贝到哪个根目录）：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>ehome@xman Demo5<span class="o">]</span>$ sudo make install
<span class="o">[</span> <span class="m">50</span>%<span class="o">]</span> Built target MathFunctions
<span class="o">[</span><span class="m">100</span>%<span class="o">]</span> Built target Demo
Install the project...
-- Install configuration: <span class="s2">&quot;&quot;</span>
-- Installing: /usr/local/bin/Demo
-- Installing: /usr/local/include/config.h
-- Installing: /usr/local/bin/libMathFunctions.a
-- Up-to-date: /usr/local/include/MathFunctions.h
<span class="o">[</span>ehome@xman Demo5<span class="o">]</span>$ ls /usr/local/bin
Demo  libMathFunctions.a
<span class="o">[</span>ehome@xman Demo5<span class="o">]</span>$ ls /usr/local/include
config.h  MathFunctions.h
</pre></div>
</div>
</section>
<section id="id10">
<h3>为工程添加测试<a class="headerlink" href="#id10" title="Permalink to this heading">#</a></h3>
<p>添加测试同样很简单。CMake 提供了一个称为 CTest 的测试工具。我们要做的只是在项目根目录的 CMakeLists 文件中调用一系列的 <code class="docutils literal notranslate"><span class="pre">add_test</span></code> 命令。</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># 启用测试</span>
<span class="nb">enable_testing</span><span class="p">()</span>

<span class="c"># 测试程序是否成功运行</span>
<span class="nb">add_test</span> <span class="p">(</span><span class="s">test_run</span><span class="w"> </span><span class="s">Demo</span><span class="w"> </span><span class="s">5</span><span class="w"> </span><span class="s">2</span><span class="p">)</span>

<span class="c"># 测试帮助信息是否可以正常提示</span>
<span class="nb">add_test</span> <span class="p">(</span><span class="s">test_usage</span><span class="w"> </span><span class="s">Demo</span><span class="p">)</span>
<span class="nb">set_tests_properties</span> <span class="p">(</span><span class="s">test_usage</span>
<span class="w">  </span><span class="s">PROPERTIES</span><span class="w"> </span><span class="s">PASS_REGULAR_EXPRESSION</span><span class="w"> </span><span class="s2">&quot;Usage: .* base exponent&quot;</span><span class="p">)</span>

<span class="c"># 测试 5 的平方</span>
<span class="nb">add_test</span> <span class="p">(</span><span class="s">test_5_2</span><span class="w"> </span><span class="s">Demo</span><span class="w"> </span><span class="s">5</span><span class="w"> </span><span class="s">2</span><span class="p">)</span>

<span class="nb">set_tests_properties</span> <span class="p">(</span><span class="s">test_5_2</span>
<span class="w"> </span><span class="s">PROPERTIES</span><span class="w"> </span><span class="s">PASS_REGULAR_EXPRESSION</span><span class="w"> </span><span class="s2">&quot;is 25&quot;</span><span class="p">)</span>

<span class="c"># 测试 10 的 5 次方</span>
<span class="nb">add_test</span> <span class="p">(</span><span class="s">test_10_5</span><span class="w"> </span><span class="s">Demo</span><span class="w"> </span><span class="s">10</span><span class="w"> </span><span class="s">5</span><span class="p">)</span>

<span class="nb">set_tests_properties</span> <span class="p">(</span><span class="s">test_10_5</span>
<span class="w"> </span><span class="s">PROPERTIES</span><span class="w"> </span><span class="s">PASS_REGULAR_EXPRESSION</span><span class="w"> </span><span class="s2">&quot;is 100000&quot;</span><span class="p">)</span>

<span class="c"># 测试 2 的 10 次方</span>
<span class="nb">add_test</span> <span class="p">(</span><span class="s">test_2_10</span><span class="w"> </span><span class="s">Demo</span><span class="w"> </span><span class="s">2</span><span class="w"> </span><span class="s">10</span><span class="p">)</span>

<span class="nb">set_tests_properties</span> <span class="p">(</span><span class="s">test_2_10</span>
<span class="w"> </span><span class="s">PROPERTIES</span><span class="w"> </span><span class="s">PASS_REGULAR_EXPRESSION</span><span class="w"> </span><span class="s2">&quot;is 1024&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>上面的代码包含了四个测试。第一个测试 <code class="docutils literal notranslate"><span class="pre">test_run</span></code> 用来测试程序是否成功运行并返回 0 值。剩下的三个测试分别用来测试 5 的 平方、10 的 5 次方、2 的 10 次方是否都能得到正确的结果。其中 <code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION</span></code> 用来测试输出是否包含后面跟着的字符串。让我们看看测试的结果：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>ehome@xman Demo5<span class="o">]</span>$ make <span class="nb">test</span>
Running tests...
Test project /home/ehome/Documents/programming/C/power/Demo5
    Start <span class="m">1</span>: test_run
<span class="m">1</span>/4 Test <span class="c1">#1: test_run .........................   Passed    0.00 sec</span>
    Start <span class="m">2</span>: test_5_2
<span class="m">2</span>/4 Test <span class="c1">#2: test_5_2 .........................   Passed    0.00 sec</span>
    Start <span class="m">3</span>: test_10_5
<span class="m">3</span>/4 Test <span class="c1">#3: test_10_5 ........................   Passed    0.00 sec</span>
    Start <span class="m">4</span>: test_2_10
<span class="m">4</span>/4 Test <span class="c1">#4: test_2_10 ........................   Passed    0.00 sec</span>

<span class="m">100</span>% tests passed, <span class="m">0</span> tests failed out of <span class="m">4</span>

Total Test <span class="nb">time</span> <span class="o">(</span>real<span class="o">)</span> <span class="o">=</span>   <span class="m">0</span>.01 sec
</pre></div>
</div>
<p>如果要测试更多的输入数据，像上面那样一个个写测试用例未免太繁琐。这时可以通过编写宏来实现：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp"># 定义一个宏，用来简化测试工作</span>
<span class="n">macro</span><span class="w"> </span><span class="p">(</span><span class="n">do_test</span><span class="w"> </span><span class="n">arg1</span><span class="w"> </span><span class="n">arg2</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="n">add_test</span><span class="w"> </span><span class="p">(</span><span class="n">test_$</span><span class="p">{</span><span class="n">arg1</span><span class="p">}</span><span class="n">_$</span><span class="p">{</span><span class="n">arg2</span><span class="p">}</span><span class="w"> </span><span class="n">Demo</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">arg1</span><span class="p">}</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">arg2</span><span class="p">})</span><span class="w"></span>
<span class="w">  </span><span class="n">set_tests_properties</span><span class="w"> </span><span class="p">(</span><span class="n">test_$</span><span class="p">{</span><span class="n">arg1</span><span class="p">}</span><span class="n">_$</span><span class="p">{</span><span class="n">arg2</span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">PROPERTIES</span><span class="w"> </span><span class="n">PASS_REGULAR_EXPRESSION</span><span class="w"> </span><span class="n">$</span><span class="p">{</span><span class="n">result</span><span class="p">})</span><span class="w"></span>
<span class="n">endmacro</span><span class="w"> </span><span class="p">(</span><span class="n">do_test</span><span class="p">)</span><span class="w"></span>

<span class="cp"># 使用该宏进行一系列的数据测试</span>
<span class="n">do_test</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="s">&quot;is 25&quot;</span><span class="p">)</span><span class="w"></span>
<span class="n">do_test</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="s">&quot;is 100000&quot;</span><span class="p">)</span><span class="w"></span>
<span class="n">do_test</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="s">&quot;is 1024&quot;</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>关于 CTest 的更详细的用法可以通过 <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">1</span> <span class="pre">ctest</span></code> 参考 CTest 的文档。</p>
</section>
</section>
<section id="gdb">
<h2>支持 gdb<a class="headerlink" href="#gdb" title="Permalink to this heading">#</a></h2>
<p>让 CMake 支持 gdb 的设置也很容易，只需要指定 <code class="docutils literal notranslate"><span class="pre">Debug</span></code> 模式下开启 <code class="docutils literal notranslate"><span class="pre">-g</span></code> 选项：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_BUILD_TYPE</span><span class="w"> </span><span class="s2">&quot;Debug&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_CXX_FLAGS_DEBUG</span><span class="w"> </span><span class="s2">&quot;$ENV{CXXFLAGS} -O0 -Wall -g -ggdb&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_CXX_FLAGS_RELEASE</span><span class="w"> </span><span class="s2">&quot;$ENV{CXXFLAGS} -O3 -Wall&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>之后可以直接对生成的程序使用 gdb 来调试。</p>
</section>
<section id="id11">
<h2>添加环境检查<a class="headerlink" href="#id11" title="Permalink to this heading">#</a></h2>
<p>本节对应的源代码所在目录：</p>
<blockquote>
<div><p><a class="reference external" href="https://link.zhihu.com/?target=https%3A//github.com/wzpan/cmake-demo/tree/master/Demo6">https://github.com/wzpan/cmake-demo/tree/master/Demo6</a></p>
</div></blockquote>
<p>有时候可能要对系统环境做点检查，例如要使用一个平台相关的特性的时候。在这个例子中，我们检查系统是否自带 pow 函数。如果带有 pow 函数，就使用它；否则使用我们定义的 power 函数。</p>
<section id="checkfunctionexists">
<h3>添加 CheckFunctionExists 宏<a class="headerlink" href="#checkfunctionexists" title="Permalink to this heading">#</a></h3>
<p>首先在顶层 CMakeLists 文件中添加 CheckFunctionExists.cmake 宏，并调用 <code class="docutils literal notranslate"><span class="pre">check_function_exists</span></code> 命令测试链接器是否能够在链接阶段找到 <code class="docutils literal notranslate"><span class="pre">pow</span></code> 函数。</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># 检查系统是否支持 pow 函数</span>
<span class="nb">include</span> <span class="p">(</span><span class="o">${</span><span class="nv">CMAKE_ROOT</span><span class="o">}</span><span class="s">/Modules/CheckFunctionExists.cmake</span><span class="p">)</span>
<span class="nb">check_function_exists</span> <span class="p">(</span><span class="s">pow</span><span class="w"> </span><span class="s">HAVE_POW</span><span class="p">)</span>
</pre></div>
</div>
<p>将上面这段代码放在 <code class="docutils literal notranslate"><span class="pre">configure_file</span></code> 命令前。</p>
</section>
<section id="id12">
<h3>预定义相关宏变量<a class="headerlink" href="#id12" title="Permalink to this heading">#</a></h3>
<p>接下来修改 <a class="reference external" href="https://link.zhihu.com/?target=http%3A//config.h.in">http://config.h.in</a> 文件，预定义相关的宏变量。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// does the platform provide pow function?</span>
<span class="cp">#cmakedefine HAVE_POW</span>
</pre></div>
</div>
</section>
<section id="id13">
<h3>在代码中使用宏和函数<a class="headerlink" href="#id13" title="Permalink to this heading">#</a></h3>
<p>最后一步是修改 <a class="reference external" href="https://link.zhihu.com/?target=http%3A//main.cc">http://main.cc</a> ，在代码中使用宏和函数：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef HAVE_POW</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Now we use the standard library. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">exponent</span><span class="p">);</span><span class="w"></span>
<span class="cp">#else</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Now we use our own Math library. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">power</span><span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">exponent</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
</pre></div>
</div>
</section>
</section>
<section id="id14">
<h2>添加版本号<a class="headerlink" href="#id14" title="Permalink to this heading">#</a></h2>
<p>本节对应的源代码所在目录：</p>
<blockquote>
<div><p><a class="reference external" href="https://link.zhihu.com/?target=https%3A//github.com/wzpan/cmake-demo/tree/master/Demo7">https://github.com/wzpan/cmake-demo/tree/master/Demo7</a></p>
</div></blockquote>
<p>给项目添加和维护版本号是一个好习惯，这样有利于用户了解每个版本的维护情况，并及时了解当前所用的版本是否过时，或是否可能出现不兼容的情况。首先修改顶层 CMakeLists 文件，在 <code class="docutils literal notranslate"><span class="pre">project</span></code> 命令之后加入如下两行：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="p">(</span><span class="s">Demo_VERSION_MAJOR</span><span class="w"> </span><span class="s">1</span><span class="p">)</span>
<span class="nb">set</span> <span class="p">(</span><span class="s">Demo_VERSION_MINOR</span><span class="w"> </span><span class="s">0</span><span class="p">)</span>
</pre></div>
</div>
<p>分别指定当前的项目的主版本号和副版本号。之后，为了在代码中获取版本信息，我们可以修改 <a class="reference external" href="https://link.zhihu.com/?target=http%3A//config.h.in">http://config.h.in</a> 文件，添加两个预定义变量：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// the configured options and settings for Tutorial</span>
<span class="cp">#define Demo_VERSION_MAJOR @Demo_VERSION_MAJOR@</span>
<span class="cp">#define Demo_VERSION_MINOR @Demo_VERSION_MINOR@</span>
</pre></div>
</div>
<p>这样就可以直接在代码中打印版本信息了：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;config.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;math/MathFunctions.h&quot;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="c1">// print version info</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s Version %d.%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="n">Demo_VERSION_MAJOR</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">Demo_VERSION_MINOR</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage: %s base exponent </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">exponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span><span class="w"></span>

<span class="cp">#if defined (HAVE_POW)</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Now we use the standard library. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">exponent</span><span class="p">);</span><span class="w"></span>
<span class="cp">#else</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Now we use our own Math library. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">power</span><span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">exponent</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%g ^ %d is %g</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">exponent</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="id15">
<h2>生成安装包<a class="headerlink" href="#id15" title="Permalink to this heading">#</a></h2>
<p>本节对应的源代码所在目录：</p>
<blockquote>
<div><p><a class="reference external" href="https://link.zhihu.com/?target=https%3A//github.com/wzpan/cmake-demo/tree/master/Demo8">https://github.com/wzpan/cmake-demo/tree/master/Demo8</a></p>
</div></blockquote>
<p>本节将学习如何配置生成各种平台上的安装包，包括二进制安装包和源码安装包。为了完成这个任务，我们需要用到 CPack ，它同样也是由 CMake 提供的一个工具，专门用于打包。首先在顶层的 CMakeLists.txt 文件尾部添加下面几行：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># 构建一个 CPack 安装包</span>
<span class="nb">include</span> <span class="p">(</span><span class="s">InstallRequiredSystemLibraries</span><span class="p">)</span>
<span class="nb">set</span> <span class="p">(</span><span class="s">CPACK_RESOURCE_FILE_LICENSE</span>
<span class="w">  </span><span class="s2">&quot;${CMAKE_CURRENT_SOURCE_DIR}/License.txt&quot;</span><span class="p">)</span>
<span class="nb">set</span> <span class="p">(</span><span class="s">CPACK_PACKAGE_VERSION_MAJOR</span><span class="w"> </span><span class="s2">&quot;${Demo_VERSION_MAJOR}&quot;</span><span class="p">)</span>
<span class="nb">set</span> <span class="p">(</span><span class="s">CPACK_PACKAGE_VERSION_MINOR</span><span class="w"> </span><span class="s2">&quot;${Demo_VERSION_MINOR}&quot;</span><span class="p">)</span>
<span class="nb">include</span> <span class="p">(</span><span class="s">CPack</span><span class="p">)</span>
</pre></div>
</div>
<p>上面的代码做了以下几个工作：</p>
<ol class="arabic simple">
<li><p>导入 InstallRequiredSystemLibraries 模块，以便之后导入 CPack 模块；</p></li>
<li><p>设置一些 CPack 相关变量，包括版权信息和版本信息，其中版本信息用了上一节定义的版本号；</p></li>
<li><p>导入 CPack 模块。</p></li>
</ol>
<p>接下来的工作是像往常一样构建工程，并执行 <code class="docutils literal notranslate"><span class="pre">cpack</span></code> 命令。</p>
<ul class="simple">
<li><p>生成二进制安装包：</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cpack -C CPackConfig.cmake
</pre></div>
</div>
<ul class="simple">
<li><p>生成源码安装包</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cpack -C CPackSourceConfig.cmake
</pre></div>
</div>
<p>我们可以试一下。在生成项目后，执行 <code class="docutils literal notranslate"><span class="pre">cpack</span> <span class="pre">-C</span> <span class="pre">CPackConfig.cmake</span></code> 命令：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>ehome@xman Demo8<span class="o">]</span>$ cpack -C CPackSourceConfig.cmake
CPack: Create package using STGZ
CPack: Install projects
CPack: - Run preinstall target <span class="k">for</span>: Demo8
CPack: - Install project: Demo8
CPack: Create package
CPack: - package: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux.sh generated.
CPack: Create package using TGZ
CPack: Install projects
CPack: - Run preinstall target <span class="k">for</span>: Demo8
CPack: - Install project: Demo8
CPack: Create package
CPack: - package: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux.tar.gz generated.
CPack: Create package using TZ
CPack: Install projects
CPack: - Run preinstall target <span class="k">for</span>: Demo8
CPack: - Install project: Demo8
CPack: Create package
CPack: - package: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux.tar.Z generated.
</pre></div>
</div>
<p>此时会在该目录下创建 3 个不同格式的二进制包文件：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>ehome@xman Demo8<span class="o">]</span>$ ls Demo8-*
Demo8-1.0.1-Linux.sh  Demo8-1.0.1-Linux.tar.gz  Demo8-1.0.1-Linux.tar.Z
</pre></div>
</div>
<p>这 3 个二进制包文件所包含的内容是完全相同的。我们可以执行其中一个。此时会出现一个由 CPack 自动生成的交互式安装界面：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>ehome@xman Demo8<span class="o">]</span>$ sh Demo8-1.0.1-Linux.sh
Demo8 Installer Version: <span class="m">1</span>.0.1, Copyright <span class="o">(</span>c<span class="o">)</span> Humanity
This is a self-extracting archive.
The archive will be extracted to: /home/ehome/Documents/programming/C/power/Demo8

If you want to stop extracting, please press &lt;ctrl-C&gt;.
The MIT License <span class="o">(</span>MIT<span class="o">)</span>

Copyright <span class="o">(</span>c<span class="o">)</span> <span class="m">2013</span> Joseph Pan<span class="o">(</span>http://hahack.com<span class="o">)</span>

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files <span class="o">(</span>the <span class="s2">&quot;Software&quot;</span><span class="o">)</span>, to deal <span class="k">in</span>
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to <span class="k">do</span> so,
subject to the following conditions:

The above copyright notice and this permission notice shall be included <span class="k">in</span> all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED <span class="s2">&quot;AS IS&quot;</span>, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


Do you accept the license? <span class="o">[</span>yN<span class="o">]</span>:
y
By default the Demo8 will be installed <span class="k">in</span>:
  <span class="s2">&quot;/home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux&quot;</span>
Do you want to include the subdirectory Demo8-1.0.1-Linux?
Saying no will install <span class="k">in</span>: <span class="s2">&quot;/home/ehome/Documents/programming/C/power/Demo8&quot;</span> <span class="o">[</span>Yn<span class="o">]</span>:
y

Using target directory: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux
Extracting, please wait...

Unpacking finished successfully
</pre></div>
</div>
<p>完成后提示安装到了 Demo8-1.0.1-Linux 子目录中，我们可以进去执行该程序：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>ehome@xman Demo8<span class="o">]</span>$ ./Demo8-1.0.1-Linux/bin/Demo <span class="m">5</span> <span class="m">2</span>
Now we use our own Math library.
<span class="m">5</span> ^ <span class="m">2</span> is <span class="m">25</span>
</pre></div>
</div>
<p>关于 CPack 的更详细的用法可以通过 <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">1</span> <span class="pre">cpack</span></code> 参考 CPack 的文档。</p>
</section>
<section id="id16">
<h2>项目迁移<a class="headerlink" href="#id16" title="Permalink to this heading">#</a></h2>
<p>CMake 可以很轻松地构建出在适合各个平台执行的工程环境。而如果当前的工程环境不是 CMake ，而是基于某个特定的平台，是否可以迁移到 CMake 呢？答案是可能的。下面针对几个常用的平台，列出了它们对应的迁移方案。</p>
<section id="autotools">
<h3>autotools<a class="headerlink" href="#autotools" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>am2cmake 可以将 autotools 系的项目转换到 CMake，这个工具的一个成功案例是 KDE 。</p></li>
<li><p>Alternative Automake2CMake 可以转换使用 automake 的 KDevelop 工程项目。</p></li>
<li><p>Converting autoconf tests</p></li>
</ul>
</section>
<section id="qmake">
<h3>qmake<a class="headerlink" href="#qmake" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>qmake converter 可以转换使用 QT 的 qmake 的工程。</p></li>
</ul>
</section>
<section id="visual-studio">
<h3>Visual Studio<a class="headerlink" href="#visual-studio" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>vcproj2cmake.rb 可以根据 Visual Studio 的工程文件（后缀名是 <code class="docutils literal notranslate"><span class="pre">.vcproj</span></code> 或 <code class="docutils literal notranslate"><span class="pre">.vcxproj</span></code>）生成 CMakeLists.txt 文件。</p></li>
<li><p>vcproj2cmake.ps1 vcproj2cmake 的 PowerShell 版本。</p></li>
<li><p>folders4cmake 根据 Visual Studio 项目文件生成相应的 “source_group” 信息，这些信息可以很方便的在 CMake 脚本中使用。支持 Visual Studio 9/10 工程文件。</p></li>
</ul>
</section>
<section id="id17">
<h3>CMakeLists.txt 自动推导<a class="headerlink" href="#id17" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>gencmake 根据现有文件推导 CMakeLists.txt 文件。</p></li>
<li><p>CMakeListGenerator 应用一套文件和目录分析创建出完整的 CMakeLists.txt 文件。仅支持 Win32 平台。</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>原文参考：https://github.com/wzpan/cmake-demo/tree/master/Demo1
http://www.cmake.org/cmake/help/cmake2.4docs.html
http://www.cmake.org/cmake/help/cmake_tutorial.html
</pre></div>
</div>
</section>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="clion.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">上一页</p>
        <p class="prev-next-title"><code class="docutils literal notranslate"><span class="pre">Clion</span></code> 项目工程基础</p>
      </div>
    </a>
    <a class="right-next"
       href="esp-idf.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">下一页</p>
        <p class="prev-next-title">ESP-IDF SDK 基础</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> 目录
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cmake">什么是 CMake?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">入门案例：单个源文件</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cmakelists-txt">编写 CMakeLists.txt</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">编译项目</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">多个源文件</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">同一目录，多个源文件</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">多个目录，多个源文件</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">自定义编译选项</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cmakelists">修改 CMakeLists 文件</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#http-main-cc">修改 http://main.cc 文件</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#http-config-h-in">编写 http://config.h.in 文件</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">编译项目</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-mymath-on">USE_MYMATH 为 ON</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-mymath-off">USE_MYMATH 为 OFF</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">安装和测试</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">定制安装规则</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">为工程添加测试</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gdb">支持 gdb</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">添加环境检查</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checkfunctionexists">添加 CheckFunctionExists 宏</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">预定义相关宏变量</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">在代码中使用宏和函数</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">添加版本号</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">生成安装包</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">项目迁移</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#autotools">autotools</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#qmake">qmake</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visual-studio">Visual Studio</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">CMakeLists.txt 自动推导</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
作者： Lemon.Go，谭文龙，罗明雄
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022, Lemon.Go@gdpu.edu.cn.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>